___
[Excalidraw doc](https://app.excalidraw.com/l/6gPaBlSh8PG/gBA95rzvos)
[Example SQL](https://github.com/Sigma-Labs-XYZ/Cohort-12-Workshop-Notes/blob/main/software-fundamentals/sql/movies/01_reference_data.sql)

Here we outline what SQL commands looks like and how to store and retrieve data.

### SQL Sample Commands:
___


```sql

DROP SCHEMA movies CASCADE;
CREATE SCHEMA movies;

DROP TABLE IF EXISTS movies.country;

CREATE TABLE movies.country (
  country_id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  country_iso_code varchar(10) DEFAULT NULL,
  country_name varchar(200) DEFAULT NULL,
  CONSTRAINT pk_country PRIMARY KEY (country_id)
);

INSERT INTO movies.country VALUES
(128,'AE','United Arab Emirates'),
(129,'AF','Afghanistan'),
(130,'AO','Angola'),
(131,'AR','Argentina'),
(132,'AT','Austria'),
(133,'AU','Australia'),
...
```


```sql
DROP TABLE IF EXISTS movies.movie_company;

CREATE TABLE movies.movie_company (
  movie_id INT DEFAULT NULL,
  company_id INT DEFAULT NULL,
  CONSTRAINT fk_mc_comp FOREIGN KEY (company_id) REFERENCES movies.production_company (company_id),
  CONSTRAINT fk_mc_movie FOREIGN KEY (movie_id) REFERENCES movies.movie (movie_id)
);


INSERT INTO movies.movie_company VALUES
(5,14),
(5,59),
(11,1),
(11,306),
(12,3),
(13,4),
(14,27),
(14,2721),
(16,11239),
(16,119),
...
```

```sql
DROP TABLE IF EXISTS movies.movie;

  

CREATE TABLE movies.movie (
movie_id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
title varchar(1000) DEFAULT NULL,
budget INT DEFAULT NULL,
homepage varchar(1000) DEFAULT NULL,
overview varchar(1000) DEFAULT NULL,
popularity decimal(12,6) DEFAULT NULL,
release_date date DEFAULT NULL,
revenue BIGINT DEFAULT NULL,
runtime INT DEFAULT NULL,
movie_status varchar(50) DEFAULT NULL,
tagline varchar(1000) DEFAULT NULL,
vote_average decimal(4,2) DEFAULT NULL,
vote_count INT DEFAULT NULL,
CONSTRAINT pk_movie PRIMARY KEY (movie_id)

);

  
  

INSERT INTO movies.movie VALUES

(5,'Four Rooms',4000000,'','It''s Ted the Bellhop''s first night on the job...and the hotel''s very unusual guests are about to place him in some outrageous predicaments. It seems that this evening''s room service is serving up one unbelievable happening after another.',22.876230,'1995-12-09',4300000,98,'Released','Twelve outrageous guests. Four scandalous requests. And one lone bellhop, in his first day on the job, who''s in for the wildest New year''s Eve of his life.',6.50,530),

(11,'Star Wars',11000000,'http://www.starwars.com/films/star-wars-episode-iv-a-new-hope','Princess Leia is captured and held hostage by the evil Imperial forces in their effort to take over the galactic Empire. Venturesome Luke Skywalker and dashing captain Han Solo team together with the loveable robot duo R2-D2 and C-3PO to rescue the beautiful princess and restore peace and justice in the Empire.',126.393695,'1977-05-25',775398007,121,'Released','A long time ago in a galaxy far, far away...',8.10,6624),

(12,'Finding Nemo',94000000,'http://movies.disney.com/finding-nemo','Nemo, an adventurous young clownfish, is unexpectedly taken from his Great Barrier Reef home to a dentist''s office aquarium. It''s up to his worrisome father Marlin and a friendly but forgetful fish Dory to bring Nemo home -- meeting vegetarian sharks, surfer dude turtles, hypnotic jellyfish, hungry seagulls, and more along the way.',85.688789,'2003-05-30',940335536,100,'Released','There are 3.7 trillion fish in the ocean, they''re looking for one.',7.60,6122),
...
```
### Some explanation:
____

A __Schema__ can be two things. 
- In the context of SQL, it means a folder that can hold tables.
- This also allows you to re-use table names.
- Here, the schema is `movies`.


The line `INT NOT NULL GENERATED BY DEFAULT AS IDENTITY` is used to define a column in a table with specific properties. Let's break it down:
1. **INT**: This specifies the data type of the column, which in this case is `INTEGER`
2. **NOT NULL**: This constraint ensures that the column cannot contain `NULL` values. Every row must have a non-null value for this column.
3. **GENERATED BY DEFAULT AS IDENTITY**: This is an identity column specification. Identity columns are used to automatically generate unique values for a column, usually used for primary keys. There are typically two ways to generate these values:  
    - **BY DEFAULT**: The database will automatically generate a value if no explicit value is provided during an insert. However, you can still insert a specific value if needed.  
    - **ALWAYS**: The database will always generate values for the identity column, and you cannot insert a specific value manually.Putting it all together, `INT NOT NULL GENERATED BY DEFAULT AS IDENTITY` specifies that the column will automatically generate a unique integer value for each row, ensuring that the value is not `NULL`. This is particularly useful for primary key columns, as it ensures a unique identifier for each row without manually managing the values.

**Constraints** in a database ensure the accuracy and reliability of the data inside the table. They restrict the type of data that can be inserted into a table to maintain data integrity. Common constraints include:  
- **NOT NULL:** Ensures that a column cannot have a NULL value.  
- **UNIQUE:** Ensures all values in a column are different.  
- **PRIMARY KEY:** Uniquely identifies each record in a table.  
- **FOREIGN KEY:** Ensures referential integrity for a record in another table.  
- **CHECK:** Ensures that the values in a column meet a specific condition.  
- **DEFAULT:** Sets a default value for a column when no value is specified.A **Primary Key** is a field (or a combination of fields) in a table that uniquely identifies each record in that table. Primary keys have the following characteristics:  
- **Unique:** No two rows can have the same primary key value.  
- **Not Null:** Primary key columns cannot contain NULL values.  
- **Immutable:** The values should not change.  
- **Single column or composite:** A primary key can consist of a single column or multiple columns.

### Getting data
___

In the below, the `;` actually ends the line. Breaking it up as we have makes it easier to read vs having it on one line.

The order of commands __IS__ important.

Commands are written __IN CAPS__. Data-base related vars are written __lowercase__.

```sql
SELECT *
FROM movies.movie
WHERE budget > 1000000
LIMIT 5;
```



The below would join tables to give a table with every character and the actor from Star Wars.

```sql
SET search_path TO movies

SELECT title, character, person_name, person.person_id
FROM movie
JOIN movie_cast on movie_cast.movie_id = movie.movie_id
JOIN movie cast on movie_cast.person_id = person.person_id
WHERE title = "STAR WARS";
```



Return Title and Where movie was created:

```SQL
SET search_path TO movies

SELECT title, country_name
FROM movie
JOIN production_country on production_country.movie_id = movie.movie_id
JOIN country ON production_country.country_id = country.country_id
```
